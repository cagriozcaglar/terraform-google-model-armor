#
# Copyright 2024 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
apiVersion: blueprints.cloud.google.com/v1alpha1
kind: BlueprintMetadata
metadata:
  # A machine-readable name for the blueprint.
  name: terraform-google-model-armor-template
  # Source repository for the blueprint.
  source:
    type: git
    location: https://github.com/GoogleCloudPlatform/terraform-google-model-armor-template
  # The release version of the blueprint.
  version: 0.1.0
  # The tool used to actuate the blueprint and its supported versions.
  actuationTool:
    type: Terraform
    version: '>= 1.3'
  # A human-readable name for the blueprint.
  title: Vertex AI Model Armor Template
  # Descriptions for the blueprint.
  descriptions:
    tagline: Creates a reusable security policy template for Vertex AI Endpoints.
    detailed: This module creates a Vertex AI Model Armor template, which defines a reusable security policy to protect deployed models from misuse and attacks.
  # Examples demonstrating the blueprint's usage.
  examples:
    - name: simple_example
      location: examples/simple_example
      title: Basic Model Armor Template
  # Labels for organizing and searching for the blueprint.
  labels:
    gcp: ''
    vertex-ai: ''
    security: ''
    mlops: ''
spec:
  # Input variables for customizing the blueprint.
  variables:
    - name: baseline_model_config_anomaly_thresholds
      description: A list of anomaly detection thresholds. Each threshold specifies an anomaly type and a value.
      type: list(object({anomaly_type=string, threshold=number}))
      default: []
      required: false
    - name: description
      description: An optional description for the Model Armor template.
      type: string
      default: null
      required: false
    - name: display_name
      description: An optional display name for the Model Armor template. If not set, template_id will be used.
      type: string
      default: null
      required: false
    - name: location
      description: The GCP region for the Model Armor template.
      type: string
      required: true
    - name: project_id
      description: The ID of the GCP project where the Model Armor template will be created.
      type: string
      required: true
    - name: signature_config_rules
      description: A list of signature rules to apply. Each rule specifies an action, priority, signature ID, and optional description.
      type: list(object({action=string, priority=number, signature_id=string, description=optional(string)}))
      default: []
      required: false
    - name: template_id
      description: The user-provided ID of the Model Armor template.
      type: string
      required: true
  # Groups of related variables for better UI presentation.
  variableGroups:
    - name: Basic Settings
      description: Core project, location, and identifier for the template.
      variables:
        - project_id
        - location
        - template_id
    - name: Template Policy
      description: Configure the security policy rules and metadata for the template.
      variables:
        - display_name
        - description
        - signature_config_rules
        - baseline_model_config_anomaly_thresholds
  # Outputs generated by the blueprint.
  outputs:
    - name: id
      description: The full resource ID of the created Model Armor template.
    - name: name
      description: The resource name of the Model Armor template.
    - name: template_id
      description: The user-provided ID of the Model Armor template.
# Defines the requirements for deploying the blueprint.
requirements:
  # GCP services that must be enabled.
  services:
    - aiplatform.googleapis.com
  # GCP IAM roles required for the service account running the blueprint.
  roles:
    - role: roles/aiplatform.admin
      level: project
  # Specific GCP IAM permissions required.
  permissions:
    - aiplatform.modelArmorTemplate.create
